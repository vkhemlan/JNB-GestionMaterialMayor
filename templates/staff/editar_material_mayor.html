{% extends 'staff/base.html' %}

{% block header_block %}
<script type="text/javascript" src="{{ STATIC_URL }}js/formulario_editar_material_mayor_script.js"></script>

<script type="text/javascript">
    var modelos_chasis = [
    {% for modelo_chasis in form.fields.modelo_chasis.queryset %}
        new Array({{ modelo_chasis.id }}, "{{ modelo_chasis }}", {{ modelo_chasis.marca.id }}),
    {% endfor %}
    ]
    
    var modelos_caja_cambio = [
    {% for modelo_caja_cambio in form.fields.modelo_caja_cambio.queryset %}
        new Array({{ modelo_caja_cambio.id }}, "{{ modelo_caja_cambio }}", {{ modelo_caja_cambio.marca.id }}),
    {% endfor %}
    ]
    
    var modelos_bomba = [
    {% for modelo_bomba in form.fields.modelo_bomba.queryset %}
        new Array({{ modelo_bomba.id }}, "{{ modelo_bomba }}", {{ modelo_bomba.marca.id }}),
    {% endfor %}
    ]
    
    var cuerpos = [
    {% for cuerpo in form_adquisicion.fields.cuerpo_destinatario.queryset %}
        new Array({{ cuerpo.id }}, "{{ cuerpo }}", {{ cuerpo.comuna.provincia.region.id }}),
    {% endfor %}
    ]
    
</script>
{% endblock %}

{% block staff_content %}
    <p class="breadcrumbs">
        <strong>Material mayor</strong>
        &raquo; {{ form.instance.breadcrumbs_string }}
    </p>

	<h2>Editar material mayor</h2>
	
	{% if not form.instance.validado_por_operaciones %}
        <p class="error_message">Este material aún no ha sido validado por la JNBC por lo que no podrá acceder a la mayoría de sus opciones.</p>
        {% if user.get_profile.puede_validar_material_mayor %}
            <form method="post" action="{% url interface.views.validar_material_mayor form.instance.id %}">
                {% csrf_token %}
                <input type="submit" value="Validar Material Mayor" />
            </form>
        {% endif %}
    {% endif %}
        
    <form method="post" action="." enctype="multipart/form-data">
        {% csrf_token %}
        <table id="form-table">
        
            <tr><td colspan="2"><br /><h3>Información general</h3><br /></td></tr>
            <tr>
                <th>Fecha de ingreso al sistema</th>
                <td>{{ form.instance.adquisicion.fecha }}</td>
            </tr>
            <tr>
                <th>Cuerpo destinatario original</th>
                <td>{{ form.instance.adquisicion.cuerpo_destinatario }} ({{ form.instance.adquisicion.cuerpo_destinatario.comuna.provincia.region }})</td>
            </tr>
            <tr>
                <th>Asignación actual</th>
                <td>{{ form.instance.get_location }} 
                
                {% if asignacion_link %}
                    (<a href="{{ asignacion_link }}">Asignar</a>)
                {% endif %}
                
                </td>
            </tr>
            <tr>
                <th>Patente</th>
                <td>
                    {% if form.instance.asignacion_de_patente %}
                        {{ form.instance.asignacion_de_patente }}
                        (<a href="{% url interface.views.detalles_patente_material_mayor form.instance.id %}">Ver detalles</a>)
                    {% else %}
                        <i>Sin patente</i>
                        {% if user.get_profile.puede_asignar_patente %}
                            (<a href="{% url interface.views.asignar_patente_a_material_mayor form.instance.id %}">Asignar patente</a>)
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
            <tr><th>Ingresado por</th><td>{{ form.instance.adquisicion.usuario.get_full_name }}</td></tr>
            <tr><th>Forma de adquisición</th><td>{{ form.instance.adquisicion.modo }} (<a href="{% url interface.views.editar_adquisicion_material_mayor form.instance.id %}">Editar detalles</a>)</td></tr>
            <tr><th>Hoja de vida</th><td><a href="{% url interface.views.detalles_hoja_de_vida_material_mayor form.instance.id %}">Ver hoja de vida</a></td></tr>

            <tr><td colspan="2"><br /><h3>Datos del vehículo</h3><br /></tr></td>
            
            {{ form.render_datos_vehiculo }}
            
            <tr><td colspan="2"><br /><h3>Información Adicional</h3><br /></tr></td>
            
            {{ form.render_informacion_adicional }}

            <tr><td colspan="2"><br /><h3>Fotografías</h3><br /></tr></td>
            {% for pair in form.picture_fields %}
                <tr>
                    <td>
                        {% if pair.0.errors %}
                            <ul class="errorlist">
                                {% for error in pair.0.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        {{ pair.0.label }}
                    </td>

                    <td>
                        {{ pair.0 }}
                    </td>   
                </tr>
            {% endfor %}
                
        </table>
        
        {% if next %}
            <input type="hidden" name="next" value="{{ next }}" />
        {% endif %}

        <input type="submit" value="Guardar cambios" />

    </form>

{% endblock %}
