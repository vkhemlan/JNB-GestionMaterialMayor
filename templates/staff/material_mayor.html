{% extends 'staff/base.html' %}

{% block header_block %}
<script type="text/javascript" src="{{ STATIC_URL }}js/formulario_buscar_material_mayor_script.js"></script>


<script type="text/javascript">
    var cuerpos = [
    {% for cuerpo in form.fields.cuerpo.queryset %}
        new Array({{ cuerpo.id }}, "{{ cuerpo }}", {{ cuerpo.comuna.provincia.region.id }}),
    {% endfor %}
    ]
    
    var default_cuerpo = {{ form.cuerpo.data|default_if_none:0 }}
</script>

{% endblock %}

{% block staff_content %}
    <p class="breadcrumbs">
        <strong>Material mayor</strong>
    </p>
    
    <h2>{{ title }}</h2>
    
    <hr />

	<div class="span-21">
            
        <form method="get" action=".">        
            <strong>Región</strong> {{ form.region }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <strong>Cuerpo</strong> {{ form.cuerpo }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            
            <input type="submit" value="Buscar" />
        </form>
        <br />
	</div>
	
	<hr />
	
	<p><a href="{% url interface.views.material_mayor_excel %}?{{ form.get_path }}">Descargar esta búsqueda como Excel</a></p>
    
    <div class="span-21">
        <table>
            <tr>
                <td colspan="5">
                    <h3>{{ search_result.title }}</h3>
                </td>
            </tr>
            
            <tr>
                <th>Marca chasis</th>
                <th>Modelo chasis</th>
                <th>Marca carrosado</th>
                <th>N° chasis</th>
                <th>N° motor</th>
                <th>Cuerpo</th>
                <th>Compañía</th>
                <th></th>
            </tr>
            
            {% for material_mayor in material_mayor %}
                <tr>
                    <td>{{ material_mayor.modelo_chasis.marca }}</td>
                    <td>{{ material_mayor.modelo_chasis }}</td>
                    <td>{{ material_mayor.marca_carrosado }}</td>
                    <td>{{ material_mayor.numero_chasis }}</td>
                    <td>{{ material_mayor.numero_motor }}</td>
                    <td>{{ material_mayor.cuerpo|default_if_none:"No asignado" }}</td>
                    <td>{{ material_mayor.compania|default_if_none:"No asignado" }}</td>
                    <td><a href="{% url interface.views.editar_material_mayor material_mayor.id %}">Editar</a></td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5">Ningún material mayor coincide con los criterios de búsqueda</td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endblock %}
